---
title: "Copy number variation (CNV) analysis of hGIC samples"
output: html_notebook
author: "Gabriel Rosser"
---

We have previously observed a bias in the direction of the differentially methylated regions (DMRs) computed in individual patients, comparing the GIC line (typically $n=2$ different passages) with one of:

- iNSC
- fibroblast
- iAPC
- iOPC
 
The patients separate into two groups, one showing bias towards hypermethylation in GIC and vice versa. 

Here, we test whether this observation is related to CNVs in the genome. Hypothesis: deletions and amplifications are both associated with a reduced estimate of methylation. Therefore, those lines exhibiting hypomethylation have more major deletions or amplifications.

We approach this by estimating CNVs directly from methylation array data. We use the following packages:

- `minfi`: does all the heavy lifting, parsing `idat` files.
- `ChAMP`: nice wrapper over `minfi` that makes it easy to filter out bad probes. Might eliminate this if we can.
- `conumee`: estimates CNV in a single sample relative to a control (assumed to reflect an unperturbed genome).

For the control, we can use any one of the comparators listed above, or all of them. We'll try a few different settings.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require("knitr")
opts_knit$set(root.dir = normalizePath('..'))

library(ChAMP)
library(conumee)

```

```{r echo=FALSE}
source("_settings.R")
```

Setup the data import directories. We simplify all this by using a metadata file generated in Python that lists all basenames, patient IDs and cell types.

```{r}
meta <- read.csv('methylation/hgic_metadata.csv', row.names = 1)
basenames <- file.path(data.dir.raid, 'methylation', rownames(meta))
```

Load the data.

```{r}
rgSet <- read.metharray(basenames, extended = T, force = T)
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

# References

Feber A, Guilhamon P, Lechner M, et al. Using high-density DNA methylation arrays to profile copy number alterations. _Genome Biol._ 2014;15(2):R30. doi:10.1186/gb-2014-15-2-r30

[The `conumee` vignette](http://www.bioconductor.org/packages/devel/bioc/vignettes/conumee/inst/doc/conumee.html)
